(function(){"use strict";let w;fetch("/kanameishi-dev-yozakura/resources/Snet_Points.json").then(o=>o.json()).then(o=>{w=o.filter(e=>e.Point&&!e.IsSuspended),self.postMessage({type:"initialized"})});const u={0:{0:{205:-3},7:{209:-2.9},14:{214:-2.8},21:{218:-2.7},28:{223:-2.6},36:{227:-2.5},43:{231:-2.4},50:{236:-2.3},57:{240:-2.2},64:{245:-2.1},72:{250:-2},85:{238:-1.9},99:{227:-1.8},112:{216:-1.7},126:{205:-1.6},140:{194:-1.5},153:{183:-1.4},167:{172:-1.3},180:{161:-1.2},194:{150:-1.1},208:{139:-1}},6:{212:{130:-.9}},12:{216:{121:-.8}},18:{220:{113:-.7}},25:{224:{104:-.6}},31:{228:{96:-.5}},37:{233:{88:-.4}},44:{237:{79:-.3}},50:{241:{71:-.2}},56:{245:{62:-.1}},63:{250:{54:0}},75:{250:{49:.1}},88:{250:{45:.2}},100:{251:{41:.3}},113:{251:{37:.4}},125:{252:{33:.5}},138:{252:{28:.6}},151:{253:{24:.7}},163:{253:{20:.8}},170:{0:{0:7}},176:{254:{16:.9}},177:{0:{0:6.9}},185:{0:{0:6.8}},189:{255:{12:1}},192:{0:{0:6.7}},195:{254:{10:1.1}},200:{0:{0:6.6}},202:{254:{9:1.2}},208:{0:{0:6.5},254:{8:1.3}},215:{0:{0:6.4},254:{7:1.4}},222:{255:{5:1.5}},223:{0:{0:6.3}},228:{254:{4:1.6}},230:{0:{0:6.2}},235:{255:{3:1.7}},238:{0:{0:6.1}},241:{254:{2:1.8}},245:{0:{0:6}},246:{6:{0:5.9}},247:{13:{0:5.8}},248:{20:{0:5.7},255:{1:1.9}},249:{27:{0:5.6}},250:{33:{0:5.5}},251:{40:{0:5.4}},252:{47:{0:5.3}},253:{54:{0:5.2}},254:{61:{0:5.1}},255:{0:{0:5},68:{0:4},144:{0:3},221:{0:2}}};function g(o,e,d){const a=Math.max(o,e,d),i=Math.min(o,e,d);let t=0,s=0,h=a;a!=i&&(a==o&&(t=60*(e-d)/(a-i)),a==e&&(t=60*(d-o)/(a-i)+120),a==d&&(t=60*(o-e)/(a-i)+240),s=(a-i)/a),t<0&&(t=t+360),t=t/360,s=s,h=h/255;let n=0;return h>.1&&s>.75&&(t>.1476?n=280.31*Math.pow(t,6)-916.05*Math.pow(t,5)+1142.6*Math.pow(t,4)-709.95*Math.pow(t,3)+234.65*Math.pow(t,2)-40.27*t+3.2217:t>.001?n=151.4*Math.pow(t,4)-49.32*Math.pow(t,3)+6.753*Math.pow(t,2)-2.481*t+.9033:n=-.005171*Math.pow(h,2)-.3282*h+1.2236),n<0&&(n=0),n}self.onmessage=async o=>{const{imageBitmap:e,y:d,uid:a}=o.data;if(!w)return;const i=new OffscreenCanvas(e.width,e.height),t=i.getContext("2d",{willReadFrequently:!0});t.drawImage(e,0,0);const s=t.getImageData(0,0,i.width,i.height).data,h=w.filter(f=>f.TileID==(d==12?1:2)),n={};h.forEach(f=>{var M,r;const p=f.Point.Y*256+f.Point.X,c=[s[4*p],s[4*p+1],s[4*p+2],s[4*p+3]];if(c[3]){let l=(r=(M=u[c[0]])==null?void 0:M[c[1]])==null?void 0:r[c[2]];if(l===void 0){const m=10**(5*g(c[0],c[1],c[2])-2);l=.868589*Math.log(m)+1}n[f.Code]={shindo:l,pga:10**(5*((l+3)/10)-2)}}else n[f.Code]={shindo:null,pga:0}}),self.postMessage({type:"decoded",data:n,y:d,uid:a})}})();
